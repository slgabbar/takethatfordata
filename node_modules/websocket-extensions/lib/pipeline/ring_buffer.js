'use strict';

var RingBuffer = function(bufferSize) ***REMOVED***
  this._bufferSize = bufferSize;
  this.clear();
***REMOVED***;

RingBuffer.prototype.clear = function() ***REMOVED***
  this._buffer     = new Array(this._bufferSize);
  this._ringOffset = 0;
  this._ringSize   = this._bufferSize;
  this._head       = 0;
  this._tail       = 0;
  this.length      = 0;
***REMOVED***;

RingBuffer.prototype.push = function(value) ***REMOVED***
  var expandBuffer = false,
      expandRing   = false;

  if (this._ringSize < this._bufferSize) ***REMOVED***
    expandBuffer = (this._tail === 0);
  ***REMOVED*** else if (this._ringOffset === this._ringSize) ***REMOVED***
    expandBuffer = true;
    expandRing   = (this._tail === 0);
  ***REMOVED***

  if (expandBuffer) ***REMOVED***
    this._tail       = this._bufferSize;
    this._buffer     = this._buffer.concat(new Array(this._bufferSize));
    this._bufferSize = this._buffer.length;

    if (expandRing)
      this._ringSize = this._bufferSize;
  ***REMOVED***

  this._buffer[this._tail] = value;
  this.length += 1;
  if (this._tail < this._ringSize) this._ringOffset += 1;
  this._tail = (this._tail + 1) % this._bufferSize;
***REMOVED***;

RingBuffer.prototype.peek = function() ***REMOVED***
  if (this.length === 0) return void 0;
  return this._buffer[this._head];
***REMOVED***;

RingBuffer.prototype.shift = function() ***REMOVED***
  if (this.length === 0) return void 0;

  var value = this._buffer[this._head];
  this._buffer[this._head] = void 0;
  this.length -= 1;
  this._ringOffset -= 1;

  if (this._ringOffset === 0 && this.length > 0) ***REMOVED***
    this._head       = this._ringSize;
    this._ringOffset = this.length;
    this._ringSize   = this._bufferSize;
  ***REMOVED*** else ***REMOVED***
    this._head = (this._head + 1) % this._ringSize;
  ***REMOVED***
  return value;
***REMOVED***;

module.exports = RingBuffer;
