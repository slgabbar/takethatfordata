'use strict'

var crc
try ***REMOVED***
  crc = require('fast-crc32c')
***REMOVED*** catch (e) ***REMOVED***
  crc = require('./crc32c.js')
***REMOVED***

var crypto = require('crypto')
var through = require('through2')

module.exports = function (cfg) ***REMOVED***
  cfg = cfg || ***REMOVED******REMOVED***

  var crc32c = cfg.crc32c !== false
  var md5 = cfg.md5 !== false

  var hashes = ***REMOVED******REMOVED***
  if (md5) hashes.md5 = crypto.createHash('md5')

  var onData = function (chunk, enc, done) ***REMOVED***
    if (crc32c) hashes.crc32c = crc.calculate(chunk, hashes.crc32c)
    if (md5) hashes.md5.update(chunk)

    done(null, chunk)
  ***REMOVED***

  var onFlush = function (done) ***REMOVED***
    if (crc32c) hashes.crc32c = new Buffer([hashes.crc32c]).toString('base64')
    if (md5) hashes.md5 = hashes.md5.digest('base64')

    done()
  ***REMOVED***

  var validationStream = through(onData, onFlush)

  validationStream.test = function (algo, sum) ***REMOVED***
    return hashes[algo] === sum
  ***REMOVED***

  return validationStream
***REMOVED***
