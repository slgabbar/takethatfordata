"use strict";

/**
 * A minimal path module to resolve Unix, Windows and URL paths alike.
 * @memberof util
 * @namespace
 */
var path = exports;

var isAbsolute =
/**
 * Tests if the specified path is absolute.
 * @param ***REMOVED***string***REMOVED*** path Path to test
 * @returns ***REMOVED***boolean***REMOVED*** `true` if path is absolute
 */
path.isAbsolute = function isAbsolute(path) ***REMOVED***
    return /^(?:\/|\w+:)/.test(path);
***REMOVED***;

var normalize =
/**
 * Normalizes the specified path.
 * @param ***REMOVED***string***REMOVED*** path Path to normalize
 * @returns ***REMOVED***string***REMOVED*** Normalized path
 */
path.normalize = function normalize(path) ***REMOVED***
    path = path.replace(/\\/g, "/")
               .replace(/\/***REMOVED***2,***REMOVED***/g, "/");
    var parts    = path.split("/"),
        absolute = isAbsolute(path),
        prefix   = "";
    if (absolute)
        prefix = parts.shift() + "/";
    for (var i = 0; i < parts.length;) ***REMOVED***
        if (parts[i] === "..") ***REMOVED***
            if (i > 0 && parts[i - 1] !== "..")
                parts.splice(--i, 2);
            else if (absolute)
                parts.splice(i, 1);
            else
                ++i;
        ***REMOVED*** else if (parts[i] === ".")
            parts.splice(i, 1);
        else
            ++i;
    ***REMOVED***
    return prefix + parts.join("/");
***REMOVED***;

/**
 * Resolves the specified include path against the specified origin path.
 * @param ***REMOVED***string***REMOVED*** originPath Path to the origin file
 * @param ***REMOVED***string***REMOVED*** includePath Include path relative to origin path
 * @param ***REMOVED***boolean***REMOVED*** [alreadyNormalized=false] `true` if both paths are already known to be normalized
 * @returns ***REMOVED***string***REMOVED*** Path to the include file
 */
path.resolve = function resolve(originPath, includePath, alreadyNormalized) ***REMOVED***
    if (!alreadyNormalized)
        includePath = normalize(includePath);
    if (isAbsolute(includePath))
        return includePath;
    if (!alreadyNormalized)
        originPath = normalize(originPath);
    return (originPath = originPath.replace(/(?:\/|^)[^/]+$/, "")).length ? normalize(originPath + "/" + includePath) : includePath;
***REMOVED***;
